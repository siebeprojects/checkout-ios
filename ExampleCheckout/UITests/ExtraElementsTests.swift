// Copyright (c) 2021 Payoneer Germany GmbH
// https://www.payoneer.com
//
// This file is open source and available under the MIT license.
// See the LICENSE file for more information.

import XCTest

final class ExtraElementsTests: NetworksTests {
    func testExtraElements_whenNone_shouldNotDisplay() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings())
            app.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            XCTAssertFalse(app.textViews["Top Element Number 1 with invalid link"].exists)
            XCTAssertFalse(app.textViews["Bottom Element Number 2 without Checkbox"].exists)
        }
    }

    func testExtraElements_whenTopAndBottom_shouldDisplayBoth() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings(division: "ExtraElements", checkoutConfiguration: .extraElementsTopBottom))
            app.tables.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            XCTAssertTrue(app.textViews["Top Element Number 1 with invalid link"].exists)
            XCTAssertTrue(app.textViews["Bottom Element Number 2 without Checkbox"].exists)
        }
    }

    func testExtraElements_whenTop_shouldDisplayTop() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings(division: "ExtraElements", checkoutConfiguration: .extraElementsTop))
            app.tables.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            XCTAssertTrue(app.textViews["Top Element Number 1 with invalid link"].exists)
            XCTAssertFalse(app.textViews["Bottom Element Number 2 without Checkbox"].exists)
        }
    }

    func testExtraElements_whenBottom_shouldDisplayBottom() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings(division: "ExtraElements", checkoutConfiguration: .extraElementsBottom))
            app.tables.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            XCTAssertFalse(app.textViews["Top Element Number 1 with invalid link"].exists)
            XCTAssertTrue(app.textViews["Bottom Element Number 2 without Checkbox"].exists)
        }
    }

    func testExtraElements_whenContainsCheckbox_shouldNotDisplay() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings(division: "ExtraElements", checkoutConfiguration: .extraElementsTopBottom))
            app.tables.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            XCTAssertFalse(app.textViews["Top Element Number 2 with a Checkbox view"].exists)
            XCTAssertFalse(app.textViews["Bottom Element Number 1 with an Checkbox optional title"].exists)
        }
    }

    func testExtraElements_whenContainsLink_shouldOpenSafari() throws {
        try XCTContext.runActivity(named: "Open payment form") { _ in
            try setupPaymentSession(with: ListSettings(division: "ExtraElements", checkoutConfiguration: .extraElementsTopBottom))
            app.staticTexts["Cards"].tap()
            XCTAssert(app.navigationBars["Payment details"].waitForExistence(timeout: .uiTimeout))
            app.textViews.firstMatch.links["Number 1"].tap()
            XCTAssertTrue(app.webViews.firstMatch.waitForExistence(timeout: .safariPresentationTimeout))
        }
    }
}
